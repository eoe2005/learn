# 国内加速

```json
{
    "registry-mirrors": [ "https://lpvp44wb.mirror.aliyuncs.com","https://registry.docker-cn.com","http://hub-mirror.c.163.com"],

    "live-restore": true 
}
```

# 镜像使用

## 数据库

### mysql

| 环境变量                       | 含义  |
| -------------------------- | --- |
| MYSQL_ROOT_PASSWORD        |     |
| MYSQL_DATABASE             |     |
| MYSQL_USER                 |     |
| MYSQL_PASSWORD             |     |
| MYSQL_ALLOW_EMPTY_PASSWORD |     |
| MYSQL_RANDOM_ROOT_PASSWORD |     |
| MYSQL_ONETIME_PASSWORD     |     |
| MYSQL_ROOT_PASSWORD_FILE   |     |

### mariadb

| 环境变量                              | 含义  |
| --------------------------------- | --- |
| MARIADB_ROOT_PASSWORD             |     |
| MYSQL_ROOT_PASSWORD               |     |
| MARIADB_ALLOW_EMPTY_ROOT_PASSWORD |     |
| MYSQL_ALLOW_EMPTY_PASSWORD        |     |
| MARIADB_RANDOM_ROOT_PASSWORD      |     |
| MYSQL_RANDOM_ROOT_PASSWORD        |     |
| MARIADB_ROOT_HOST                 |     |
| MYSQL_ROOT_HOST                   |     |
| MARIADB_MYSQL_LOCALHOST_USER      |     |
| MARIADB_MYSQL_LOCALHOST_GRANTS    |     |
| MARIADB_DATABASE                  |     |
| MYSQL_DATABASE                    |     |
| MARIADB_USER                      |     |
| MYSQL_USER                        |     |
| MARIADB_PASSWORD                  |     |
| MYSQL_PASSWORD                    |     |
| MARIADB_INITDB_SKIP_TZINFO        |     |
| MYSQL_INITDB_SKIP_TZINFO          |     |
| MARIADB_AUTO_UPGRADE              |     |
| MARIADB_DISABLE_UPGRADE_BACKUP    |     |

### postgres

#### 地址 [Postgres - Official Image | Docker Hub](https://hub.docker.com/_/postgres)

#### 环境

| 变量                        | 含义    |
| ------------------------- | ----- |
| POSTGRES_PASSWORD         |       |
| POSTGRES_USER             |       |
| POSTGRES_DB               |       |
| POSTGRES_INITDB_ARGS      |       |
| POSTGRES_INITDB_WALDIR    |       |
| POSTGRES_HOST_AUTH_METHOD |       |
| PGDATA                    |       |
| POSTGRES_PASSWORD_FILE    | 密码文件件 |

### influxdb

#### 地址

[Influxdb - Official Image | Docker Hub](https://hub.docker.com/_/influxdb)

#### 端口

8086

#### 目录

```
/var/lib/influxdb2
/etc/influxdb2/config.yml
```

#### 环境变量

```
DOCKER_INFLUXDB_INIT_USERNAME: The username to set for the system's initial super-user (Required).
DOCKER_INFLUXDB_INIT_PASSWORD: The password to set for the system's inital super-user (Required).
DOCKER_INFLUXDB_INIT_ORG: The name to set for the system's initial organization (Required).
DOCKER_INFLUXDB_INIT_BUCKET: The name to set for the system's initial bucket (Required).
DOCKER_INFLUXDB_INIT_RETENTION: The duration the system's initial bucket should retain data. If not set, the initial bucket will retain data forever.
DOCKER_INFLUXDB_INIT_ADMIN_TOKEN: The authentication token to associate with the system's initial super-user. If not set, a token will be auto-generated by the system.
```

### mongo

#### 地址

[Mongo - Official Image | Docker Hub](https://hub.docker.com/_/mongo)

#### 数据存储位置

/data/db

#### 环境

| 变量                         |     |
| -------------------------- | --- |
| MONGO_INITDB_ROOT_USERNAME |     |
| MONGO_INITDB_ROOT_PASSWORD |     |

## 消息队列

### rabbitmq

#### 地址

[Rabbitmq - Official Image | Docker Hub](https://hub.docker.com/_/rabbitmq)

#### 变量

```shell
RABBITMQ_DEFAULT_PASS_FILE
RABBITMQ_DEFAULT_USER_FILE
RABBITMQ_MANAGEMENT_SSL_CACERTFILE
RABBITMQ_MANAGEMENT_SSL_CERTFILE
RABBITMQ_MANAGEMENT_SSL_DEPTH
RABBITMQ_MANAGEMENT_SSL_FAIL_IF_NO_PEER_CERT
RABBITMQ_MANAGEMENT_SSL_KEYFILE
RABBITMQ_MANAGEMENT_SSL_VERIFY
RABBITMQ_SSL_CACERTFILE
RABBITMQ_SSL_CERTFILE
RABBITMQ_SSL_DEPTH
RABBITMQ_SSL_FAIL_IF_NO_PEER_CERT
RABBITMQ_SSL_KEYFILE
RABBITMQ_SSL_VERIFY
RABBITMQ_VM_MEMORY_HIGH_WATERMARK
```

#### 管理后台

```console
rabbitmq:3-management
```

### Kafka

#### 地址

[bitnami/kafka - Docker Image | Docker Hub](https://hub.docker.com/r/bitnami/kafka)

#### 目录

```yaml
/bitnami/kafka
```

#### 端口

```
9092
9093
```

#### 配置

The configuration can easily be setup with the Bitnami Apache Kafka Docker image using the following environment variables:

- `ALLOW_PLAINTEXT_LISTENER`: Allow to use the PLAINTEXT listener. Default: **no**.
- `KAFKA_INTER_BROKER_USER`: Apache Kafka inter broker communication user. Default: admin. Default: **user**.
- `KAFKA_INTER_BROKER_PASSWORD`: Apache Kafka inter broker communication password. Default: **bitnami**.
- `KAFKA_CERTIFICATE_PASSWORD`: Password for certificates. No defaults.
- `KAFKA_HEAP_OPTS`: Apache Kafka's Java Heap size. Default: **-Xmx1024m -Xms1024m**.
- `KAFKA_ZOOKEEPER_PROTOCOL`: Authentication protocol for Zookeeper connections. Allowed protocols: **PLAINTEXT**, **SASL**, **SSL**, and **SASL_SSL**. Defaults: **PLAINTEXT**.
- `KAFKA_ZOOKEEPER_USER`: Apache Kafka Zookeeper user for SASL authentication. No defaults.
- `KAFKA_ZOOKEEPER_PASSWORD`: Apache Kafka Zookeeper user password for SASL authentication. No defaults.
- `KAFKA_ZOOKEEPER_TLS_KEYSTORE_PASSWORD`: Apache Kafka Zookeeper keystore file password and key password. No defaults.
- `KAFKA_ZOOKEEPER_TLS_TRUSTSTORE_PASSWORD`: Apache Kafka Zookeeper truststore file password. No defaults.
- `KAFKA_ZOOKEEPER_TLS_VERIFY_HOSTNAME`: Verify Zookeeper hostname on TLS certificates. Defaults: **true**.
- `KAFKA_ZOOKEEPER_TLS_TYPE`: Choose the TLS certificate format to use. Allowed values: `JKS`, `PEM`. Defaults: **JKS**.
- `KAFKA_CFG_SASL_ENABLED_MECHANISMS`: Allowed mechanism when using SASL either for clients, inter broker, or zookeeper comunications. Allowed values: `PLAIN`, `SCRAM-SHA-256`, `SCRAM-SHA-512` or a comma separated combination of those values. Default: **PLAIN,SCRAM-SHA-256,SCRAM-SHA-512**
- `KAFKA_CFG_SASL_MECHANISM_INTER_BROKER_PROTOCOL`: SASL mechanism to use for inter broker communications. No defaults.
- `KAFKA_TLS_CLIENT_AUTH`: Configures kafka brokers to request client authentication. Allowed values: `required`, `requested`, `none`. Defaults: **required**.
- `KAFKA_TLS_TYPE`: Choose the TLS certificate format to use. Allowed values: `JKS`, `PEM`. Defaults: **JKS**.
- `KAFKA_CLIENT_USERS`: Users that will be created into Zookeeper when using SASL for client communications. Separated by commas. Default: **user**
- `KAFKA_CLIENT_PASSWORDS`: Passwords for the users specified at`KAFKA_CLIENT_USERS`. Separated by commas. Default: **bitnami**
- `KAFKA_CFG_MAX_PARTITION_FETCH_BYTES`: The maximum amount of data per-partition the server will return. Default: **1048576**
- `KAFKA_CFG_MAX_REQUEST_SIZE`: The maximum size of a request in bytes. Default: **1048576**
- `KAFKA_ENABLE_KRAFT`: Whether to enable Kafka Raft (KRaft) mode. Default: **no**
- `KAFKA_KRAFT_CLUSTER_ID`: Kafka cluster ID when using Kafka Raft (KRaft). No defaults.

Additionally, any environment variable beginning with `KAFKA_CFG_` will be mapped to its corresponding Apache Kafka key. For example, use `KAFKA_CFG_BACKGROUND_THREADS` in order to set `background.threads` or `KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE` in order to configure `auto.create.topics.enable`

```diff
- KAFKA_ENABLE_KRAFT=yes
+      - KAFKA_CFG_PROCESS_ROLES=broker,controller
+      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
-      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092
+      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093
+      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
       - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092
       - KAFKA_BROKER_ID=1
+      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@127.0.0.1:9093
-      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181
       - ALLOW_PLAINTEXT_LISTENER=yes
```

## 配置中心

### zookeeper

#### 地址

[Zookeeper - Official Image | Docker Hub](https://hub.docker.com/_/zookeeper)

#### 端口

```
2181 2888 3888 8080
```

#### composer

```
version: '3.1'

services:
  zoo1:
    image: zookeeper
    restart: always
    hostname: zoo1
    ports:
      - 2181:2181
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo2:
    image: zookeeper
    restart: always
    hostname: zoo2
    ports:
      - 2182:2181
    environment:
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo3:
    image: zookeeper
    restart: always
    hostname: zoo3
    ports:
      - 2183:2181
    environment:
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181
```

## 搜索

### elasticsearch

#### 地址

[Elasticsearch - Official Image | Docker Hub](https://hub.docker.com/_/elasticsearch)

#### 端口

```
9200 9300
```

#### 执行

```
docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:tag
```
